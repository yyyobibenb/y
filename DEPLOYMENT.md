# Развертывание на reg.ru с ISPManager

## Подготовка проекта

### 1. Сборка проекта
```bash
npm run build
```

### 2. Файлы для загрузки
Загрузите на сервер следующие файлы и папки:
- `dist/` (папка с собранным бэкендом)
- `client/dist/` (папка с собранным фронтендом)
- `package.json`
- `drizzle.config.ts`
- `shared/`

## Настройка на сервере reg.ru

### 1. Создание Node.js приложения в ISPManager
1. Войдите в ISPManager
2. Перейдите в "Node.js" → "Создать приложение"
3. Укажите:
   - Домен: ваш домен
   - Версия Node.js: 18 или 20
   - Startup file: `dist/index.js`
   - Environment: `production`

### 2. Настройка базы данных PostgreSQL
1. В ISPManager создайте базу данных PostgreSQL
2. Запишите данные подключения:
   - Хост: обычно `localhost`
   - Порт: `5432`
   - Имя базы: имя созданной базы
   - Логин: имя пользователя
   - Пароль: пароль пользователя

### 3. Переменные окружения
В настройках Node.js приложения добавьте переменные:
```
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://логин:пароль@localhost:5432/имя_базы
SESSION_SECRET=ваш_длинный_секретный_ключ_минимум_32_символа
```

### 4. Загрузка файлов
1. Через файловый менеджер ISPManager загрузите все файлы проекта
2. Структура должна быть:
```
/var/www/ваш_домен/data/
├── dist/
├── client/
├── shared/
├── package.json
└── drizzle.config.ts
```

### 5. Установка зависимостей
Подключитесь к серверу по SSH или используйте терминал в ISPManager:
```bash
cd /var/www/ваш_домен/data/
npm install --only=production
```

### 6. Применение миграций базы данных
```bash
npm run db:push
```

### 7. Настройка статических файлов
В ISPManager в настройках домена:
1. Документ-рут: `/var/www/ваш_домен/data/client/dist`
2. Создайте правило проксирования для API:
   - Path: `/api/*`
   - Target: `http://localhost:3000`

### 8. Запуск приложения
1. В разделе Node.js приложений нажмите "Запустить"
2. Приложение должно иметь статус "Запущен"

## SSL сертификат
1. В ISPManager перейдите в "SSL сертификаты"
2. Выпустите Let's Encrypt сертификат для домена

## Мониторинг
- Логи приложения доступны в ISPManager в разделе Node.js
- Проверяйте статус приложения регулярно
- Настройте автозапуск при перезагрузке сервера

## Обновление
Для обновления приложения:
1. Загрузите новые файлы
2. Выполните `npm install` если изменились зависимости
3. Примените миграции БД: `npm run db:push`
4. Перезапустите приложение в ISPManager

## Возможные проблемы
- **Ошибка подключения к БД**: проверьте DATABASE_URL
- **Ошибка прав доступа**: установите права 755 для папок, 644 для файлов
- **Статические файлы не загружаются**: проверьте настройки документ-рута